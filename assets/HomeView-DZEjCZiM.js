import{u as W}from"./list-CTSFtV6i.js";import{u as B}from"./settings-OMo5dP7V.js";import{g as D,o as F,a as _,n as R,w as q,b as G,r as O,c as k,t as C,u as S,s as x,d as H,e as $,f as w,h,i as A,j as U,V as P,k as z}from"./index-Fp7Z4zFN.js";import{V as M,a as J}from"./VRow-CF4gNdRa.js";function V(e){return D()?(F(e),!0):!1}function N(){const e=new Set,t=s=>{e.delete(s)};return{on:s=>{e.add(s);const o=()=>t(s);return V(o),{off:o}},off:t,trigger:(...s)=>Promise.all(Array.from(e).map(o=>o(...s))),clear:()=>{e.clear()}}}const K=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Q=Object.prototype.toString,X=e=>Q.call(e)==="[object Object]";function Y(e){return G()}function E(e){return Array.isArray(e)?e:[e]}function Z(e,t=!0,n){Y()?_(e,n):t?e():R(e)}function ee(e,t,n){return q(e,t,{...n,immediate:!0})}const L=K?window:void 0;function te(e){var t;const n=C(e);return(t=n==null?void 0:n.$el)!=null?t:n}function ne(...e){const t=[],n=()=>{t.forEach(i=>i()),t.length=0},f=(i,r,l,d)=>(i.addEventListener(r,l,d),()=>i.removeEventListener(r,l,d)),a=k(()=>{const i=E(C(e[0])).filter(r=>r!=null);return i.every(r=>typeof r!="string")?i:void 0}),s=ee(()=>{var i,r;return[(r=(i=a.value)==null?void 0:i.map(l=>te(l)))!=null?r:[L].filter(l=>l!=null),E(C(a.value?e[1]:e[0])),E(S(a.value?e[2]:e[1])),C(a.value?e[3]:e[2])]},([i,r,l,d])=>{if(n(),!(i!=null&&i.length)||!(r!=null&&r.length)||!(l!=null&&l.length))return;const c=X(d)?{...d}:d;t.push(...i.flatMap(p=>r.flatMap(v=>l.map(g=>f(p,v,g,c)))))},{flush:"post"}),o=()=>{s(),n()};return V(n),o}function oe(){const e=O(!1),t=G();return t&&_(()=>{e.value=!0},t),e}function ie(e){const t=oe();return k(()=>(t.value,!!e()))}function re(e={}){const{window:t=L,requestPermissions:n=!0}=e,f=e,a=ie(()=>{if(!t||!("Notification"in t))return!1;if(Notification.permission==="granted")return!0;try{const u=new Notification("");u.onshow=()=>{u.close()}}catch(u){if(u.name==="TypeError")return!1}return!0}),s=O(a.value&&"permission"in Notification&&Notification.permission==="granted"),o=O(null),i=async()=>{if(a.value)return!s.value&&Notification.permission!=="denied"&&await Notification.requestPermission()==="granted"&&(s.value=!0),s.value},{on:r,trigger:l}=N(),{on:d,trigger:c}=N(),{on:p,trigger:v}=N(),{on:g,trigger:I}=N(),y=async u=>{if(!a.value||!s.value)return;const m=Object.assign({},f,u);return o.value=new Notification(m.title||"",m),o.value.onclick=l,o.value.onshow=c,o.value.onerror=v,o.value.onclose=I,o.value},T=()=>{o.value&&o.value.close(),o.value=null};if(n&&Z(i),V(T),a.value&&t){const u=t.document;ne(u,"visibilitychange",m=>{m.preventDefault(),u.visibilityState==="visible"&&T()})}return{isSupported:a,notification:o,ensurePermissions:i,permissionGranted:s,show:y,close:T,onClick:r,onShow:d,onError:p,onClose:g}}const ce={__name:"HomeView",setup(e){const t=W(),{currentItem:n,items:f,timeleft:a}=x(t),{setCurrentItem:s,countdown:o,setFinishedItem:i}=t,r=B(),{selectedAlarmFile:l,notify:d}=x(r);let c={STOP:0,COUNTING:1,PAUSE:2};const p=O(c.STOP);let v=0;const g=()=>{p.value===c.STOP&&f.value.length>0&&s(),p.value=c.COUNTING,v=setInterval(()=>{o(),a.value===0&&y()},1e3)},I=()=>{p.value=c.PAUSE,clearInterval(v)},y=()=>{clearInterval(v),p.value=c.STOP;const m=new Audio;if(m.src=l.value,m.play(),d.value){const{show:b,isSupported:j}=re({title:"事項完成",body:n.value,icon:new URL(""+new URL("tomato-DsgosIia.png",import.meta.url).href,import.meta.url).href});j.value&&b()}i(),f.value.length>0&&g()},T=k(()=>n.value.length>0?n.value:f.value.length>0?"點擊開始":"沒有事項"),u=k(()=>{const m=Math.floor(a.value/60).toString().padStart(2,"0"),b=(a.value%60).toString().padStart(2,"0");return m+":"+b});return(m,b)=>($(),H(z,null,{default:w(()=>[h(J,null,{default:w(()=>[h(M,{cols:"12"},{default:w(()=>[A("h1",null,U(T.value),1),A("h1",null,U(u.value),1)]),_:1}),h(M,{cols:"12"},{default:w(()=>[h(P,{variant:"text",icon:"mdi-play",disable:p.value===S(c).COUNTING||S(n).length===0&&S(f).length===0,onClick:g},null,8,["disable"]),h(P,{variant:"text",icon:"mdi-pause",disabled:p.value!==S(c).COUNTING,onClick:I},null,8,["disabled"]),h(P,{variant:"text",icon:"mdi-skip-next",disabled:S(n).length===0,onClick:y},null,8,["disabled"])]),_:1})]),_:1})]),_:1}))}};export{ce as default};
